name: Check the setup process
on:
  push:
    branches:
      - action-test

jobs:
  runs-on: ubuntu-latest
  container:
    image: debian:10.13-slim
  env:
    MARIADB_ROOT_PASSWORD: ilias
    MARIADB_DATABASE: ilias
    MARIADB_USER: ilias
    MARIADB_ROOT_HOST: mariadb
  services:
    mariadb:
      image: mariadb:10.9
      env:
        MARIADB_ROOT_PASSWORD: ilias
        MARIADB_USER: ilias
  steps:
    - name: Get Code
      uses: actions/checkout@v3
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: 7.4
        extensions: dom, curl, libxml, mbstring, zip, gd, json, readline, xsl
        tools: composer:v1
        coverage: none
    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/libs/composer/vendor
        key: ${{ env.CACHE_KEY }}-${{ hashFiles('**/composer.lock') }}
    - name: Install dependencies
      run: composer install --no-interaction --no-progress
    - name: PHP Unit Test 
      run: CI/PHPUnit/run_tests.sh

